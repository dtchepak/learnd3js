<!DOCTYPE html>
<html>
<head>
<title>Bar charts 3</title>
<script src="/d3/d3.min.js" charset="utf-8"></script>
<style>
.chart rect {
      fill: steelblue;
}

.chart text {
      fill: white;
        font: 10px sans-serif;
          text-anchor: end;
}
</style>
</head>
<body>
<div>
    From <a href="http://bost.ocks.org/mike/bar/3/">http://bost.ocks.org/mike/bar/3/</a>
</div>

<!--
<svg class="chart" width="420" height="120">
  <g transform="translate(0,0)">
    <rect width="40" height="19"></rect>
    <text x="37" y="9.5" dy=".35em">4</text>
  </g>
</svg>
-->

<h1>My attempt</h1>

<svg id="mychart" class="chart"></svg>

<script>
var cnst = function(x) { return x; };
var lookup = function(key) { return function(d) { return d[key]; } };
var compose = function(f,g) { return function(x) { return f(g(x)); } };

var width = 420,
    height = 350;

var scale = d3.scale.linear()
              .range([0, height]);
var chart = d3.select("#mychart")
              .attr("width", width)
              .attr("height", height);

d3.tsv("data.tsv", type, function(error, data) {
    var barSize = width / data.length;
    scale.domain( [0, d3.max(data, lookup("value")) ] );

    var bar = chart.selectAll("g")
          .data(data)
        .enter().append("g")
          .attr("transform", function(d, i) { return "translate(" + i*barSize + ",0)"; });

    bar.append("rect")
        .attr("y", function(d) { return height - scale(d.value); })
        .attr("height", compose(scale, lookup("value")))
        .attr("width", barSize - 1);
    bar.append("text")
        .attr("y", function(d) { return height - scale(d.value) + 3; })
        .attr("x", barSize / 2)
        .attr("dy", ".75em")
        .text(lookup("value"));
});

function type(d) {
    d.value = +d.value; // coerce to number
    return d;
}
</script>
</body>
</html>

